window.addEventListener("DOMContentLoaded",()=>{const commentForm=document.querySelector('.comment-form');const submitButton=document.querySelector('.submit-comment');const likeButton=document.querySelector('.like-button');commentForm.addEventListener('submit',async function(event){event.preventDefault();submitButton.disabled=true;try{const formData=new FormData(this);if(!formData.get("comment_by")){formData.set("comment_by",page_data?.user_info.name);}
if(!formData.get("comment_email")){formData.set("comment_email",page_data?.user_info.email);}
formData.set("reference_name",page_data?.blog_name);formData.set("reference_doctype","Blog Post");formData.set("route",location.pathname);const response=await fetch('/api/method/frappe.templates.includes.comments.comments.add_comment',{method:'POST',headers:{'Content-Type':'application/json',"X-Frappe-CSRF-Token":frappe.csrf_token},body:JSON.stringify(Object.fromEntries(formData)),});if(!response.ok){throw new Error(`HTTP error! Status: ${response.status}`);}
await response.json();location.reload();}catch(error){document.querySelector(".error-message").innerHTML="Something went wrong!";document.querySelector(".error-message").style.display="block";submitButton.disabled=false;}});commentForm.addEventListener('keydown',function(event){if((event.ctrlKey||event.metaKey)&&event.keyCode===13){submitButton.click();}});likeButton.onclick=async function(event){event.preventDefault();likeButton.disabled=true;try{const formData=new FormData();formData.set("reference_name",page_data?.blog_name);formData.set("like",!page_data?.liked_by_user);formData.set("reference_doctype","Blog Post");formData.set("route",location.pathname);const response=await fetch('/api/method/blog.templates.includes.likes.likes.like',{method:'POST',headers:{'Content-Type':'application/json',"X-Frappe-CSRF-Token":frappe.csrf_token},body:JSON.stringify(Object.fromEntries(formData)),});if(!response.ok){throw new Error(`HTTP error! Status: ${response.status}`);}
await response.json();location.reload();}catch(error){console.log(error);likeButton.disabled=false;}};});